Index: app/src/main/java/com/example/walktoshop/User/CardView.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.walktoshop.User;\r\n\r\nimport android.app.ActivityManager;\r\nimport android.content.ComponentName;\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.content.SharedPreferences;\r\nimport android.content.pm.LabeledIntent;\r\nimport android.content.pm.PackageManager;\r\nimport android.content.pm.ResolveInfo;\r\nimport android.content.res.Resources;\r\nimport android.os.Bundle;\r\nimport android.text.Html;\r\nimport android.util.Log;\r\nimport android.view.MenuItem;\r\nimport android.view.View;\r\nimport android.widget.Button;\r\nimport android.widget.ImageButton;\r\nimport android.widget.ProgressBar;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.annotation.Nullable;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\n\r\nimport com.example.walktoshop.NetworkController.NetworkController;\r\nimport com.example.walktoshop.R;\r\nimport com.example.walktoshop.Seller.Discount;\r\nimport com.google.android.gms.tasks.OnCompleteListener;\r\nimport com.google.android.gms.tasks.Task;\r\nimport com.google.firebase.firestore.DocumentSnapshot;\r\nimport com.google.firebase.firestore.FirebaseFirestore;\r\nimport com.google.gson.Gson;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.Iterator;\r\nimport java.util.List;\r\n\r\npublic class CardView extends AppCompatActivity {\r\n    private ProgressBar progressBar;\r\n    private Discount d;\r\n    private String UID=null;\r\n    private long totalSteps=0;\r\n    private TextView goalStepRatio;\r\n    private TextView kcal;\r\n    private TextView kilometers;\r\n    private TextView code;\r\n    private String userWeight=null;\r\n    private String userHeight=null;\r\n    private ImageButton shareButton;\r\n    private String locality=null;\r\n    private String name=null;\r\n    int percentage=0;\r\n    private TextView title;\r\n    String discountCode=null;\r\n    FirebaseFirestore db=FirebaseFirestore.getInstance();\r\n\r\n\r\n    @Override\r\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_card_view);\r\n        getSupportActionBar().setDisplayHomeAsUpEnabled(true);\r\n        getSupportActionBar().setHomeButtonEnabled(true);\r\n        progressBar = (ProgressBar) findViewById(R.id.progerssBar);\r\n        goalStepRatio= findViewById(R.id.goalStepsRatio);\r\n        shareButton=findViewById(R.id.shareButton);\r\n        kcal=findViewById(R.id.kcal);\r\n        code=findViewById(R.id.code);\r\n        kilometers = findViewById(R.id.kilometers);\r\n        title=findViewById(R.id.title);\r\n\r\n        Intent intent=getIntent();\r\n        if(intent.hasExtra(\"discount\") && intent.hasExtra(\"UID\")){\r\n            Gson gson = new Gson();\r\n            String jsonDiscount=intent.getStringExtra(\"discount\");\r\n            Log.d(\"d\",jsonDiscount);\r\n            this.d = gson.fromJson(jsonDiscount, Discount.class);\r\n            this.UID = intent.getStringExtra(\"UID\");\r\n        }\r\n        discountCode=UID+d.getUID();\r\n        code.setText(d.getDescription());\r\n        shareButton.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                shareDiscount();\r\n            }\r\n        });\r\n\r\n    }\r\n\r\n    @Override\r\n    protected void onStart() {\r\n        super.onStart();\r\n        NetworkController networkController =new NetworkController();\r\n        if(!networkController.isConnected(CardView.this)){\r\n            networkController.connectionDialog(CardView.this);\r\n        }\r\n        long beginDiscountDate= Long.parseLong(d.getStartDiscountDate());\r\n        long expiringDiscountDate= Long.parseLong(d.getExpiringDate());\r\n        getBusinessInfo(d.getBusinessUID());\r\n        getUserInfo();\r\n        //getUserWalkInATimeRange(beginDiscountDate,expiringDiscountDate,goal,d);\r\n\r\n    }\r\n    private void updateUI(){\r\n        long goal= Long.parseLong(d.getDiscountsQuantity());\r\n        CardView.this.totalSteps=getSharedPrefDiscountSteps(d.getUID());\r\n        Log.d(\"totalSteps\",totalSteps+\"\");\r\n        if(totalSteps!=0 && goal!=0){\r\n            percentage=Math.round((float)(totalSteps*100)/goal);\r\n            if(percentage>=100){\r\n                goalStepRatio.setText(goal+\"/\"+goal);\r\n                code.setText(\"Ecco il tuo codice sconto: \"+discountCode);\r\n                updateDiscountStateSharedPref(d.getUID());\r\n            }else{\r\n                goalStepRatio.setText(totalSteps+\"/\"+goal);\r\n            }\r\n            progressBar.setProgress((int)percentage);\r\n            Log.d(\"peso altezzo\",userWeight+\" \"+userHeight);\r\n            float km=calculateKilometers(Integer.parseInt(CardView.this.userHeight), totalSteps);\r\n            kilometers.setText(km+\" Km\");\r\n            int calories=calculateKcal(Integer.parseInt(CardView.this.userWeight),totalSteps);\r\n            kcal.setText(calories+\" Kcal\");\r\n        }\r\n    }\r\n    private void updateDiscountStateSharedPref(String discountUID){\r\n        SharedPreferences prefs = getApplicationContext().getSharedPreferences(discountUID, MODE_PRIVATE);\r\n        SharedPreferences.Editor editor = prefs.edit();\r\n        editor.putString(\"state\", \"completed\");\r\n        editor.apply();\r\n    }\r\n    private int getSharedPrefDiscountSteps(String discountUID){\r\n        SharedPreferences prefs = getApplicationContext().getSharedPreferences(discountUID, MODE_PRIVATE);\r\n        if(prefs.contains(\"steps\")){\r\n            int value=prefs.getInt(\"steps\", -1);\r\n            return value;\r\n        }else{\r\n            return -1;\r\n        }\r\n    }\r\n    private void getBusinessInfo(String businessUID){\r\n        db.collection(\"attivita\").document(businessUID).get().addOnCompleteListener(new OnCompleteListener<DocumentSnapshot>() {\r\n            @Override\r\n            public void onComplete(@NonNull Task<DocumentSnapshot> task) {\r\n                if(task.isSuccessful()){\r\n                    DocumentSnapshot document= task.getResult();\r\n                    CardView.this.locality=document.getString(\"locality\");\r\n                    CardView.this.name=document.getString(\"name\");\r\n                    title.setText(name+\", \"+locality);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    @Override\r\n    public boolean onOptionsItemSelected(@NonNull MenuItem item) {\r\n        if(item.getItemId() == android.R.id.home){\r\n            finish();\r\n        }\r\n        return super.onOptionsItemSelected(item);\r\n    }\r\n    private void getUserInfo(){\r\n        db.collection(\"utente\").document(UID).get().addOnCompleteListener(new OnCompleteListener<DocumentSnapshot>() {\r\n            @Override\r\n            public void onComplete(@NonNull Task<DocumentSnapshot> task) {\r\n                if(task.isSuccessful()){\r\n                    DocumentSnapshot document= task.getResult();\r\n                    CardView.this.userWeight=document.getString(\"weight\");\r\n                    CardView.this.userHeight=document.getString(\"height\");\r\n                    updateUI();\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    private float calculateKilometers(int height,long steps){\r\n        float meters;\r\n        Log.d(\"hei\",height+\" \"+steps);\r\n        if(height<170){\r\n            meters=Math.round((float)600*steps/1000);\r\n        }else{\r\n            meters=Math.round((float)700*steps/1000);\r\n        }\r\n        float kilometers=meters/1000;\r\n        Log.d(\"km\",kilometers+\"\");\r\n        return kilometers;\r\n    }\r\n    private int calculateKcal(int weight,long steps){\r\n        int kcal;\r\n        Log.d(\"weight\",weight+\"\");\r\n        kcal= (int) Math.round((float)weight*0.0005*steps);\r\n        Log.d(\"kcal\",kcal+\"\");\r\n        return kcal;\r\n    }\r\n    private void shareDiscount(){\r\n        String message=name+\", \"+locality+\"\\n\"+d.getDescription()+\"\\n\"+\"Ecco il codice sconto che ti Ã¨ stato regalato:\\n\"+discountCode+\"\\n\";\r\n        Intent sendIntent = new Intent();\r\n        sendIntent.setAction(Intent.ACTION_SEND);\r\n        sendIntent.putExtra(Intent.EXTRA_TEXT, message);\r\n        sendIntent.setType(\"text/plain\");\r\n\r\n        Intent shareIntent = Intent.createChooser(sendIntent, null);\r\n        startActivity(shareIntent);\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/walktoshop/User/CardView.java	(revision 8b558a1ec8100893a9489627f94184d742b1a8b8)
+++ app/src/main/java/com/example/walktoshop/User/CardView.java	(date 1612194899956)
@@ -18,24 +18,20 @@
 import android.widget.ImageButton;
 import android.widget.ProgressBar;
 import android.widget.TextView;
-import android.widget.Toast;
 
 import androidx.annotation.NonNull;
 import androidx.annotation.Nullable;
 import androidx.appcompat.app.AppCompatActivity;
 
-import com.example.walktoshop.NetworkController.NetworkController;
+import com.example.walktoshop.Model.Discount;
 import com.example.walktoshop.R;
-import com.example.walktoshop.Seller.Discount;
+import com.example.walktoshop.Utils.NetworkController;
 import com.google.android.gms.tasks.OnCompleteListener;
 import com.google.android.gms.tasks.Task;
 import com.google.firebase.firestore.DocumentSnapshot;
 import com.google.firebase.firestore.FirebaseFirestore;
 import com.google.gson.Gson;
 
-import java.util.ArrayList;
-import java.util.Iterator;
-import java.util.List;
 
 public class CardView extends AppCompatActivity {
     private ProgressBar progressBar;
diff --git .idea/shelf/Uncommitted_changes_before_Update_at_28_01_2021_09_53__Default_Changelist_.xml .idea/shelf/Uncommitted_changes_before_Update_at_28_01_2021_09_53__Default_Changelist_.xml
diff --git .idea/shelf/Uncommitted_changes_before_Update_at_30_01_2021_14_49__Default_Changelist_.xml .idea/shelf/Uncommitted_changes_before_Update_at_30_01_2021_14_49__Default_Changelist_.xml
diff --git .idea/shelf/Uncommitted_changes_before_Update_at_28_01_2021_10_26__Default_Changelist_.xml .idea/shelf/Uncommitted_changes_before_Update_at_28_01_2021_10_26__Default_Changelist_.xml
diff --git .idea/shelf/Uncommitted_changes_before_Update_at_25_01_2021_17_24__Default_Changelist_.xml .idea/shelf/Uncommitted_changes_before_Update_at_25_01_2021_17_24__Default_Changelist_.xml
diff --git .idea/shelf/Uncommitted_changes_before_Update_at_29_01_2021_15_30__Default_Changelist_.xml .idea/shelf/Uncommitted_changes_before_Update_at_29_01_2021_15_30__Default_Changelist_.xml
diff --git .idea/shelf/Uncommitted_changes_before_Update_at_29_01_2021_14_36__Default_Changelist_.xml .idea/shelf/Uncommitted_changes_before_Update_at_29_01_2021_14_36__Default_Changelist_.xml
diff --git .idea/shelf/Uncommitted_changes_before_Update_at_01_02_2021_12_57__Default_Changelist_.xml .idea/shelf/Uncommitted_changes_before_Update_at_01_02_2021_12_57__Default_Changelist_.xml
