Index: app/src/main/java/com/example/walktoshop/Login_SignUp/SignUp.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.walktoshop.Login_SignUp;\r\n\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\nimport android.util.Log;\r\nimport android.util.Patterns;\r\nimport android.view.Gravity;\r\nimport android.view.View;\r\nimport android.widget.Button;\r\nimport android.widget.CompoundButton;\r\nimport android.widget.EditText;\r\nimport android.widget.Switch;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\nimport androidx.annotation.NonNull;\r\nimport androidx.annotation.Nullable;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\n\r\nimport com.example.walktoshop.Utils.NetworkController;\r\nimport com.example.walktoshop.R;\r\nimport com.example.walktoshop.Model.Seller;\r\nimport com.example.walktoshop.Seller.SellerView;\r\nimport com.example.walktoshop.Model.User;\r\nimport com.example.walktoshop.User.UserView;\r\nimport com.google.android.gms.tasks.OnCompleteListener;\r\nimport com.google.android.gms.tasks.OnFailureListener;\r\nimport com.google.android.gms.tasks.OnSuccessListener;\r\nimport com.google.android.gms.tasks.Task;\r\nimport com.google.firebase.auth.AuthResult;\r\nimport com.google.firebase.auth.FirebaseAuth;\r\nimport com.google.firebase.auth.FirebaseAuthUserCollisionException;\r\nimport com.google.firebase.firestore.FirebaseFirestore;\r\nimport java.util.ArrayList;\r\nimport java.util.regex.Pattern;\r\n\r\n\r\npublic class SignUp extends AppCompatActivity {\r\n\r\n    FirebaseFirestore db = FirebaseFirestore.getInstance();\r\n    FirebaseAuth mAuth=FirebaseAuth.getInstance();\r\n    private EditText password;\r\n    private EditText confpassword;\r\n    private EditText email;\r\n    private Switch switchButton;\r\n    private Button goNext;\r\n    private TextView already_registered;\r\n    private EditText height;\r\n    private EditText weight;\r\n    private boolean isSeller;\r\n    String stringEmail=null;\r\n    String stringPassword=null;\r\n    String stringConfPassword=null;\r\n    String stringHeight=null;\r\n    String stringWeight=null;\r\n    Seller seller=new Seller();\r\n    private User user=new User();\r\n\r\n    @Override\r\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_signup);\r\n        password=(EditText) findViewById(R.id.password);\r\n        confpassword=(EditText) findViewById(R.id.confermapassword);\r\n        email=(EditText) findViewById(R.id.email);\r\n        switchButton=(Switch)findViewById(R.id.switch1);\r\n        goNext=(Button)findViewById(R.id.nextButton);\r\n        height = (EditText) findViewById(R.id.height);\r\n        weight = (EditText) findViewById(R.id.weight);\r\n        already_registered = (TextView) findViewById(R.id.already_registered);\r\n        goNext.setVisibility(View.VISIBLE);\r\n        seller.setUID(mAuth.getUid());\r\n\r\n        already_registered.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                goUserLogInActivity();\r\n            }\r\n        });\r\n\r\n        switchButton.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {\r\n            @Override\r\n            public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {\r\n                if(switchButton.isChecked()){\r\n                    weight.setVisibility(View.GONE);\r\n                    height.setVisibility(View.GONE);\r\n                    isSeller = true;\r\n                } else {\r\n                    isSeller = false;\r\n                    weight.setVisibility(View.VISIBLE);\r\n                    height.setVisibility(View.VISIBLE);\r\n                }\r\n            }\r\n        });\r\n\r\n        goNext.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                if(checkUserInfo()){\r\n                    if(switchButton.isChecked()){\r\n                        //crea e carica il negoziante\r\n                        createSeller();\r\n                    }else{\r\n                        //lato utente\r\n                        createUser();\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    @Override\r\n    protected void onStart() {\r\n        super.onStart();\r\n        NetworkController networkController =new NetworkController();\r\n        if(!networkController.isConnected(SignUp.this)){\r\n            networkController.connectionDialog(SignUp.this);\r\n        }\r\n    }\r\n\r\n    private void goSellerViewActivity(){\r\n        final Intent intent = new Intent(this, SellerView.class);\r\n        intent.putExtra(\"UID\", seller.getUID());\r\n        startActivity(intent);\r\n    }\r\n\r\n    private void goUserLogInActivity(){\r\n        final Intent intent = new Intent(this, LogIn.class);\r\n        startActivity(intent);\r\n    }\r\n\r\n    private void createUser() {\r\n        user.setEmail(stringEmail);\r\n        user.setPassword(stringPassword);\r\n        mAuth.createUserWithEmailAndPassword(user.getEmail(),user.getPassword()).addOnCompleteListener(new OnCompleteListener<AuthResult>() {\r\n            @Override\r\n            public void onComplete(@NonNull Task<AuthResult> task) {\r\n                if(task.isSuccessful()){\r\n                    uploadUser();\r\n                }else{\r\n                    try\r\n                    {\r\n                        throw task.getException();\r\n                    }catch (FirebaseAuthUserCollisionException existEmail) {\r\n                        email.setError(getResources().getString(R.string.emailExists));\r\n                        email.requestFocus();\r\n                    }catch(Exception e ){\r\n                        e.printStackTrace();\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    private void uploadUser() {\r\n\r\n        user.setHeight(stringHeight);\r\n        user.setWeight(stringWeight);\r\n        user.setUID(mAuth.getUid());\r\n        user.setWalk(new ArrayList<String>());\r\n        user.setDiscountUID(new ArrayList<>());\r\n\r\n        db.collection(\"utente\").document(user.getUID()).set(user).addOnSuccessListener(new OnSuccessListener<Void>() {\r\n            @Override\r\n            public void onSuccess(Void aVoid) {\r\n                goHomeActivity();\r\n                finish();\r\n            }\r\n        }).addOnFailureListener(new OnFailureListener() {\r\n            @Override\r\n            public void onFailure(@NonNull Exception e) {\r\n\r\n            }\r\n        });\r\n    }\r\n\r\n    public void goHomeActivity() {\r\n        final Intent intent = new Intent(SignUp.this, UserView.class);\r\n        intent.putExtra(\"UID\",user.getUID());\r\n        startActivity(intent);\r\n    }\r\n\r\n    private void createSeller() {\r\n        seller.setEmail(stringEmail);\r\n        seller.setPassword(stringPassword);\r\n        mAuth.createUserWithEmailAndPassword(seller.getEmail(),seller.getPassword()).addOnCompleteListener(new OnCompleteListener<AuthResult>() {\r\n            @Override\r\n            public void onComplete(@NonNull Task<AuthResult> task) {\r\n                if(task.isSuccessful()){\r\n                    uploadSeller();\r\n                }else{\r\n                    try\r\n                    {\r\n                        throw task.getException();\r\n                    }catch (FirebaseAuthUserCollisionException existEmail) {\r\n                        email.setError(getResources().getString(R.string.emailExists));\r\n                        email.requestFocus();\r\n                    }catch(Exception e ){\r\n                        e.printStackTrace();\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    private void uploadSeller() {\r\n        String sellerUID=mAuth.getUid();\r\n        seller.setUID(sellerUID);\r\n        db.collection(\"venditore\").document(sellerUID).set(seller).addOnSuccessListener(new OnSuccessListener<Void>() {\r\n            @Override\r\n            public void onSuccess(Void aVoid) {\r\n                Log.d(\"SUCCESSO\",\"successoo\");\r\n                goSellerViewActivity();\r\n            }\r\n        }).addOnFailureListener(new OnFailureListener() {\r\n            @Override\r\n            public void onFailure(@NonNull Exception e) {\r\n                Log.d(\"FALLIMENTO\",\"fallito\");\r\n            }\r\n        });\r\n    }\r\n\r\n    private boolean checkUserInfo(){\r\n        stringEmail=this.email.getText().toString().trim();\r\n        stringPassword= this.password.getText().toString().trim();\r\n        stringConfPassword= this.confpassword.getText().toString().trim();\r\n        stringHeight = this.height.getText().toString().trim();\r\n        stringWeight = this.weight.getText().toString().trim();\r\n\r\n        Pattern PASSWORD_PATTERN\r\n                = Pattern.compile(\"^\" + \"(?=.*[0-9])\" + \"(?=.*[a-z])\" + \"(?=.*[A-Z])\" + \"(?=.*[@#$%&?!_])\" + \"(?=\\\\S+$)\" + \".{8,}\" + \"$\");\r\n\r\n        if(stringEmail.isEmpty()){\r\n            this.email.setError(getResources().getString(R.string.emailEmpty));\r\n            this.email.requestFocus();\r\n            return false;\r\n        }else if(!Patterns.EMAIL_ADDRESS.matcher(stringEmail).matches()){\r\n            this.email.setError(getResources().getString(R.string.InvalidEmail));\r\n            this.email.requestFocus();\r\n            return false;\r\n        }else if(stringPassword.isEmpty()){\r\n            this.password.setError(getResources().getString(R.string.passwordEmpty));\r\n            this.password.requestFocus();\r\n            return false;\r\n        }else if(stringConfPassword.isEmpty()){\r\n            this.confpassword.setError(getResources().getString(R.string.passwordEmpty));\r\n            this.confpassword.requestFocus();\r\n            return false;\r\n        }else if(!isSeller && stringHeight.isEmpty()){\r\n            this.height.setError( getResources().getString(R.string.heightEmpty));\r\n            this.height.requestFocus();\r\n            return false;\r\n        }else if(!isSeller && stringWeight.isEmpty()) {\r\n            this.weight.setError(getResources().getString(R.string.weightEmpty));\r\n            this.weight.requestFocus();\r\n            return false;\r\n        }else if(!PASSWORD_PATTERN.matcher(stringPassword).matches()){\r\n            Toast toast = Toast.makeText(this,\"La password deve essere lunga almeno 8 caratteri e inserire almeno: una lettera minuscola,una maiuscola, un carattere speciale[@,#,$,%,&,?,!,_] e un numero\",Toast.LENGTH_LONG);\r\n            toast.setGravity(Gravity.CENTER, 0, 0);\r\n            toast.show();\r\n            this.password.setError(getResources().getString(R.string.InvalidPassword));\r\n            this.password.requestFocus();\r\n            return false;\r\n        }else if(!stringPassword.equals(stringConfPassword)){\r\n            this.confpassword.setError(getResources().getString(R.string.EqualPassword));\r\n            this.confpassword.requestFocus();\r\n            this.password.setError(getResources().getString(R.string.EqualPassword));\r\n            this.password.requestFocus();\r\n            return false;\r\n        }else  if(!isSeller && (Long.parseLong(stringHeight) < 100 || Long.parseLong(stringHeight) > 270)){\r\n            Toast toast = Toast.makeText(this,\"inserire un'altezza compresa tra 100cm e 278cm\",Toast.LENGTH_LONG);\r\n            toast.setGravity(Gravity.CENTER, 0, 0);\r\n            toast.show();\r\n            this.height.setError( getResources().getString(R.string.InvalidHeight));\r\n            this.height.requestFocus();\r\n            return false;\r\n        }else if(!isSeller && (Long.parseLong(stringWeight) < 40 || Long.parseLong(stringWeight) > 250)){\r\n            Toast toast = Toast.makeText(this,\"inserire un peso che sia compreso tra 40kg e 250kg\",Toast.LENGTH_LONG);\r\n            toast.setGravity(Gravity.CENTER, 0, 0);\r\n            toast.show();\r\n            this.weight.setError(getResources().getString(R.string.InvalidWeight));\r\n            this.weight.requestFocus();\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n}\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/walktoshop/Login_SignUp/SignUp.java	(revision 9f2b292f2f2efab664a5a56c7c4b7a1bdd29ab70)
+++ app/src/main/java/com/example/walktoshop/Login_SignUp/SignUp.java	(date 1612263172911)
@@ -118,6 +118,9 @@
     }
 
     private void goSellerViewActivity(){
+        Toast toast = Toast.makeText(this,"Registrazione effettuata con succeso!",Toast.LENGTH_SHORT);
+        toast.setGravity(Gravity.CENTER, 0, 0);
+        toast.show();
         final Intent intent = new Intent(this, SellerView.class);
         intent.putExtra("UID", seller.getUID());
         startActivity(intent);
@@ -174,6 +177,9 @@
     }
 
     public void goHomeActivity() {
+        Toast toast = Toast.makeText(getApplicationContext(),"Registrazione effettuata con succeso!",Toast.LENGTH_SHORT);
+        toast.setGravity(Gravity.CENTER, 0, 0);
+        toast.show();
         final Intent intent = new Intent(SignUp.this, UserView.class);
         intent.putExtra("UID",user.getUID());
         startActivity(intent);
@@ -208,7 +214,6 @@
         db.collection("venditore").document(sellerUID).set(seller).addOnSuccessListener(new OnSuccessListener<Void>() {
             @Override
             public void onSuccess(Void aVoid) {
-                Log.d("SUCCESSO","successoo");
                 goSellerViewActivity();
             }
         }).addOnFailureListener(new OnFailureListener() {
Index: app/src/main/res/values/strings.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><resources>\r\n    <string name=\"app_name\">WalkToShop</string>\r\n    <string name=\"action_settings\">Impostazioni</string>\r\n    <string name=\"action_exit\">Esci</string>\r\n    <string name=\"search\">search</string>\r\n    <string name=\"content_description_search\">contenuto</string>\r\n    <string name=\"action_home\">home</string>\r\n    <string name=\"action_map\">mappa</string>\r\n    <string name=\"action_statistics\">statistiche</string>\r\n    <string name=\"action_discount\">miei sconti</string>\r\n    <string name=\"action_notification\">notifiche</string>\r\n    <string name=\"action_search\">cerca</string>\r\n    <string name=\"snackbar_message\">Caricamento schermata di inserimento sconto</string>\r\n    <string name=\"snackbar_action\">CLOSE</string>\r\n    <string name=\"email\">Email</string>\r\n    <string name=\"password\">Password</string>\r\n    <string name=\"emailEmpty\">Inserire email</string>\r\n    <string name=\"passwordEmpty\">Inserire password</string>\r\n    <string name=\"usernameEmpty\">Inserire username</string>\r\n    <string name=\"heightEmpty\">Inserire altezza</string>\r\n    <string name=\"weightEmpty\">Inserire peso</string>\r\n    <string name=\"numStepsEmpty\">Inserire numero passi</string>\r\n    <string name=\"InvalidPassword\">Password non valida</string>\r\n    <string name=\"EqualPassword\">La password non corrisponde</string>\r\n    <string name=\"InvalidEmail\">Email non valida</string>\r\n    <string name=\"InvalidUsername\">Password non valida</string>\r\n    <string name=\"emailExists\">Email già esistente</string>\r\n    <string name=\"usernameExists\">Username già esistente</string>\r\n    <string name=\"weight\">Peso</string>\r\n    <string name=\"height\">Altezza</string>\r\n    <string name=\"InvalidWeight\">formato peso errato</string>\r\n    <string name=\"InvalidHeight\">formato altezza errato</string>\r\n    <string name=\"title_activity_seller_maps_view\">Map</string>\r\n    <string name=\"numStepsNotValid\">Numero passi non valido</string>\r\n    <string name=\"InvalidDescription\">Descrizione non valida</string>\r\n    <string name=\"InvalidDateFormat\">Formato data errato</string>\r\n    <string name=\"InvalidDate\">Data errata</string>\r\n    <string name=\"EmptyDate\">Inserire data di scadenza</string>\r\n    <string name=\"NotADay\">Giorno non esistente</string>\r\n    <string name=\"NotAMonth\">Mese non esistente</string>\r\n    <string name=\"NotAYearFree\">Anno errato</string>\r\n    //framgent_manageDiscount\r\n    <string name=\"disocuntsQuantity\">Passi da compiere per lo sconto</string>\r\n    <string name=\"percentage\">Percentuale</string>\r\n    <string name=\"description\">Descrizione</string>\r\n    <string name=\"expiringDate\">Data di scadenza</string>\r\n    <string name=\"add\">Aggiungi</string>\r\n    //dialog\r\n    <string name=\"yes\">Si</string>\r\n    <string name=\"no\">No</string>\r\n    <string name=\"ok\">Ok</string>\r\n    <string name=\"businessNotFound\">Ci dispiace!Località non trovata.Riprovare</string>\r\n    <string name=\"emptyBusiness\">Non possiedi attività.Vuoi registrarne una?</string>\r\n    <string name=\"action_stepcounter\">Pedometro</string>\r\n    <string name=\"addBusinessDialog\">Cliccare sul marker in rosso, per confermare l\\'inserimento dell\\'attività</string>\r\n</resources>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/values/strings.xml	(revision 9f2b292f2f2efab664a5a56c7c4b7a1bdd29ab70)
+++ app/src/main/res/values/strings.xml	(date 1612266085881)
@@ -50,7 +50,7 @@
     <string name="no">No</string>
     <string name="ok">Ok</string>
     <string name="businessNotFound">Ci dispiace!Località non trovata.Riprovare</string>
-    <string name="emptyBusiness">Non possiedi attività.Vuoi registrarne una?</string>
+    <string name="emptyBusiness">Non possiedi attività! Per registrarne una clicca il bottone in basso a destra!</string>
     <string name="action_stepcounter">Pedometro</string>
     <string name="addBusinessDialog">Cliccare sul marker in rosso, per confermare l\'inserimento dell\'attività</string>
 </resources>
\ No newline at end of file
Index: app/src/main/java/com/example/walktoshop/Utils/ViewAdapter.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.walktoshop.Utils;\r\n\r\nimport android.app.ActivityManager;\r\nimport android.content.Context;\r\nimport android.content.Intent;\r\nimport android.content.SharedPreferences;\r\nimport android.util.Log;\r\nimport android.view.Gravity;\r\nimport android.view.LayoutInflater;\r\nimport android.view.View;\r\nimport android.view.ViewGroup;\r\nimport android.widget.ArrayAdapter;\r\nimport android.widget.ImageButton;\r\nimport android.widget.ImageView;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.annotation.Nullable;\r\n\r\nimport com.example.walktoshop.Model.Discount;\r\nimport com.example.walktoshop.R;\r\nimport com.example.walktoshop.User.CardView;\r\nimport com.example.walktoshop.User.ServiceStepCounter;\r\nimport com.google.android.gms.tasks.OnCompleteListener;\r\nimport com.google.android.gms.tasks.OnFailureListener;\r\nimport com.google.android.gms.tasks.OnSuccessListener;\r\nimport com.google.android.gms.tasks.Task;\r\nimport com.google.firebase.firestore.DocumentSnapshot;\r\nimport com.google.firebase.firestore.FirebaseFirestore;\r\nimport com.google.gson.Gson;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.Calendar;\r\n\r\nimport static android.content.Context.MODE_PRIVATE;\r\n\r\npublic class ViewAdapter extends ArrayAdapter {\r\n    private Context context;\r\n    private ArrayList<Discount> discounts;\r\n    private String UID;\r\n    private ArrayList<String> businessUID;\r\n    private String usage;\r\n    FirebaseFirestore db =FirebaseFirestore.getInstance();\r\n\r\n    public ViewAdapter(Context context, ArrayList<Discount> discounts, String UID, ArrayList businessUID, String usage) {\r\n        super(context, R.layout.activity_viewadapter);\r\n        this.context=context;\r\n        this.discounts=discounts;\r\n        this.UID = UID;\r\n        this.usage= usage;\r\n        this.businessUID = businessUID;\r\n\r\n    }\r\n    @Override\r\n    public int getCount() {\r\n        return discounts.size();\r\n    }\r\n    @Override\r\n    public Object getItem(int position) {\r\n        return discounts.get(position);\r\n    }\r\n\r\n    @Override\r\n    public long getItemId(int position) {\r\n        return position;\r\n    }\r\n    @Override\r\n    public int getViewTypeCount() {\r\n        if(getCount() > 0){\r\n            return getCount();\r\n        }else{\r\n            return super.getViewTypeCount();\r\n        }\r\n    }\r\n    @Override\r\n    public int getItemViewType(int position) {\r\n        return position;\r\n    }\r\n\r\n    @NonNull\r\n    @Override\r\n    public View getView(int position, @Nullable View convertView, @NonNull ViewGroup parent) {\r\n        LayoutInflater layoutInflater=(LayoutInflater) context.getApplicationContext().getSystemService(Context.LAYOUT_INFLATER_SERVICE);\r\n        final View activity = layoutInflater.inflate(R.layout.activity_viewadapter,parent,false);\r\n        //caratteristiche card di sconto\r\n        TextView disocuntDescription= activity.findViewById(R.id.disocuntDescription);\r\n        TextView date = activity.findViewById(R.id.date);\r\n        //bottone eliminazione\r\n        ImageButton deleteDiscount =activity.findViewById(R.id.deleteDiscount);\r\n        //modifica\r\n        TextView difficulty = activity.findViewById(R.id.difficulty);\r\n        ImageView difficultyColor = activity.findViewById(R.id.difficultyColor);\r\n        ImageButton arrow = (ImageButton) activity.findViewById(R.id.arrow);\r\n        ImageView addDiscount = (ImageView) activity.findViewById(R.id.addButton);\r\n        View card = activity.findViewById(R.id.card);\r\n\r\n        //bottone attivazione contapassi\r\n        //bottone abilitazione\r\n        if(this.discounts.get(position) != null && position>=0 && !discounts.isEmpty()){\r\n            Discount d=this.discounts.get(position);\r\n            //settare tutti gli attributi xml\r\n            Log.d(\"DATE\", d.millisecondsToDate(d.getExpiringDate()));\r\n            date.setText(\"scadenza: \"+d.millisecondsToDate(d.getExpiringDate()));\r\n            disocuntDescription.setText(d.getDescription());\r\n            String stringedGoal=d.getDiscountsQuantity();\r\n            Log.d(\"string\",stringedGoal+\"\");\r\n\r\n            if(stringedGoal != null){\r\n                int goal= Integer.parseInt(stringedGoal);\r\n\r\n                if(goal<5000){\r\n                    difficulty.setText(\"Facile\");\r\n\r\n                }else if(goal>=5000 && goal<=20000){\r\n                    difficulty.setText(\"Difficoltà Media\");\r\n                    difficultyColor.setImageResource(R.drawable.ic_yellow);\r\n                }else if(goal>20000){\r\n                    difficulty.setText(\"Difficile\");\r\n                    difficultyColor.setImageResource(R.drawable.ic_red);\r\n                }\r\n            }\r\n            //visibility\r\n            deleteDiscount.setVisibility(View.GONE);\r\n            if(this.usage==\"sellerHome\"){\r\n                arrow.setVisibility(View.GONE);\r\n                addDiscount.setVisibility(View.GONE);\r\n                deleteDiscount.setVisibility(View.VISIBLE);\r\n                if(d != null){\r\n                    if(Long.parseLong(d.getExpiringDate()) < Calendar.getInstance().getTimeInMillis()){\r\n                        date.setText(\"Scaduto\");\r\n                    }\r\n                }\r\n\r\n                deleteDiscount.setOnClickListener(new View.OnClickListener() {\r\n                    @Override\r\n                    public void onClick(View v) {\r\n                        //Log.d(\"p\",discounts.get(position).getUID()+\" \");\r\n                        getBusiness(position);\r\n                    }\r\n                });\r\n            }else if(this.usage==\"userHome\"){\r\n                arrow.setVisibility(View.VISIBLE);\r\n                addDiscount.setVisibility(View.GONE);\r\n                if(getSharedPrefDiscountState(d.getUID())==\"completed\"){\r\n                    date.setText(\"Completato\");\r\n                }\r\n                arrow.setOnClickListener(new View.OnClickListener() {\r\n                    @Override\r\n                    public void onClick(View v) {\r\n                        final Intent intent = new Intent(getContext(), CardView.class);\r\n                        Gson gson = new Gson();\r\n                        String jsonDiscount = gson.toJson(d);\r\n                        intent.putExtra(\"discount\",jsonDiscount);\r\n                        Log.d(\"json\",jsonDiscount);\r\n                        intent.putExtra(\"UID\",UID);\r\n                        context.startActivity(intent);\r\n                    }\r\n                });\r\n                //qui si devono inserire elementi grafici tipici della vista in cui è chiamato\r\n            }else if(this.usage==\"backdropList\"){\r\n                arrow.setVisibility(View.GONE);\r\n                addDiscount.setVisibility(View.VISIBLE);\r\n                addDiscount.setOnClickListener(new View.OnClickListener() {\r\n                    @Override\r\n                    public void onClick(View view) {\r\n                        saveDiscountSharedPref(d);\r\n                        killServiceIfRunning();\r\n                        addDiscounts(d.getUID());\r\n                        card.setVisibility(View.GONE);\r\n                        Toast toast =  Toast.makeText(getContext(),\"Sconto aggiunto con successo!Visita la Home\",Toast.LENGTH_LONG);\r\n                        toast.setGravity(Gravity.CENTER, 0, 0);\r\n                        toast.show();\r\n\r\n                        //funzione che sava in shared pref\r\n                    }\r\n                });\r\n                //qui si devono inserire elementi grafici tipici della vista in cui è chiamato\r\n            }\r\n        }\r\n        return activity;\r\n    }\r\n    private void saveDiscountSharedPref(Discount d){\r\n        SharedPreferences prefs = getContext().getSharedPreferences(d.getUID(), MODE_PRIVATE);\r\n        SharedPreferences.Editor editor = prefs.edit();\r\n        editor.putInt(\"steps\", 0);\r\n        editor.putString(\"state\",null);\r\n        editor.commit();\r\n    }\r\n    private String getSharedPrefDiscountState(String discountUID){\r\n        SharedPreferences prefs = getContext().getSharedPreferences(discountUID, MODE_PRIVATE);\r\n        if(prefs.contains(\"state\")){\r\n            String value=prefs.getString(\"state\",null);\r\n            return value;\r\n        }else{\r\n            return null;\r\n        }\r\n    }\r\n    private void deleteDiscount(int position){\r\n        //getBusiness(position);\r\n        db.collection(\"sconti\").document(discounts.get(position).getUID())\r\n                .delete()\r\n                .addOnSuccessListener(new OnSuccessListener<Void>() {\r\n                    @Override\r\n                    public void onSuccess(Void aVoid) {\r\n                        Log.d(\"delete\", \"DocumentSnapshot successfully deleted!\");\r\n                    }\r\n                })\r\n                .addOnFailureListener(new OnFailureListener() {\r\n                    @Override\r\n                    public void onFailure(@NonNull Exception e) {\r\n                        Log.w(\"delete\", \"Error deleting document\", e);\r\n                    }\r\n                }).addOnCompleteListener(new OnCompleteListener<Void>() {\r\n            @Override\r\n            public void onComplete(@NonNull Task<Void> task) {\r\n                ViewAdapter.this.discounts.remove(position);\r\n                ViewAdapter.this.notifyDataSetChanged();\r\n            }\r\n        });\r\n    }\r\n\r\n    private void getBusiness(int position)\r\n    {\r\n        db.collection(\"attivita\").document(businessUID.get(0)).get().addOnCompleteListener(new OnCompleteListener<DocumentSnapshot>() {\r\n            @Override\r\n            public void onComplete(@NonNull Task<DocumentSnapshot> task) {\r\n                if(task.isSuccessful())\r\n                {   Log.d(\"position\",position+\" \");\r\n                    DocumentSnapshot document = task.getResult();\r\n                    ArrayList<String> discountUID = (ArrayList<String>) document.get(\"discountUID\");\r\n                    discountUID.remove(position);\r\n                    Log.d(\"discountUID\", discountUID.size()+\" \");\r\n                    updateBusiness(discountUID,position);\r\n                }else{\r\n                    Log.d(\"non successo\",\"non successo\");\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    private void updateBusiness(ArrayList<String> discountUID,int position)\r\n    {\r\n        db.collection(\"attivita\").document(businessUID.get(0)).update(\"discountUID\",discountUID).addOnCompleteListener(new OnCompleteListener<Void>() {\r\n            @Override\r\n            public void onComplete(@NonNull Task<Void> task) {\r\n                if(task.isSuccessful())\r\n                {\r\n                    deleteDiscount(position);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    //query di aggiunta sconto\r\n    private void addDiscounts(String discountuid){\r\n        db.collection(\"utente\").document(UID).get().addOnCompleteListener(new OnCompleteListener<DocumentSnapshot>() {\r\n            @Override\r\n            public void onComplete(@NonNull Task<DocumentSnapshot> task) {\r\n                if(task.isSuccessful()){\r\n                    DocumentSnapshot document=task.getResult();\r\n                    ArrayList<String> discountUID= (ArrayList<String>) document.get(\"discountUID\");\r\n                    if(discountUID==null){\r\n                        discountUID=new ArrayList<>();\r\n                    }\r\n                    discountUID.add(discountuid);\r\n                    updateUserDiscounts(discountUID);\r\n                }\r\n            }\r\n        });\r\n    }\r\n    private void updateUserDiscounts(ArrayList<String> discountUID){\r\n        db.collection(\"utente\").document(UID).update(\"discountUID\",discountUID);\r\n    }\r\n    private void killServiceIfRunning(){\r\n        if(isMyServiceRunning(ServiceStepCounter.class) == true){\r\n            Intent intent =new Intent(getContext(), ServiceStepCounter.class);\r\n            Toast.makeText(getContext(),\"Contapassi disattivato\",Toast.LENGTH_SHORT).show();\r\n            getContext().stopService(intent);\r\n        }\r\n    }\r\n    private boolean isMyServiceRunning(Class<?> serviceClass) {\r\n        ActivityManager manager = (ActivityManager) getContext().getSystemService(Context.ACTIVITY_SERVICE);\r\n        for (ActivityManager.RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) {\r\n            if (serviceClass.getName().equals(service.service.getClassName())) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/walktoshop/Utils/ViewAdapter.java	(revision 9f2b292f2f2efab664a5a56c7c4b7a1bdd29ab70)
+++ app/src/main/java/com/example/walktoshop/Utils/ViewAdapter.java	(date 1612264034273)
@@ -214,6 +214,9 @@
                 }).addOnCompleteListener(new OnCompleteListener<Void>() {
             @Override
             public void onComplete(@NonNull Task<Void> task) {
+                Toast toast = Toast.makeText(getContext(),"Sconto cancellato con successo!",Toast.LENGTH_SHORT);
+                toast.setGravity(Gravity.CENTER, 0, 0);
+                toast.show();
                 ViewAdapter.this.discounts.remove(position);
                 ViewAdapter.this.notifyDataSetChanged();
             }
Index: app/src/main/java/com/example/walktoshop/User/UserView.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.walktoshop.User;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.core.app.ActivityCompat;\r\nimport android.Manifest;\r\nimport android.app.ActivityManager;\r\nimport android.app.AlertDialog;\r\nimport android.app.NotificationChannel;\r\nimport android.app.NotificationManager;\r\nimport android.content.Context;\r\nimport android.content.DialogInterface;\r\nimport android.content.Intent;\r\nimport android.content.SharedPreferences;\r\nimport android.content.pm.PackageManager;\r\nimport android.location.Address;\r\nimport android.location.Geocoder;\r\nimport android.location.Location;\r\nimport android.location.LocationListener;\r\nimport android.location.LocationManager;\r\nimport android.os.Build;\r\nimport android.os.Bundle;\r\nimport android.provider.Settings;\r\nimport android.util.Log;\r\nimport android.view.Menu;\r\nimport android.view.MenuItem;\r\nimport android.view.View;\r\nimport android.widget.ListView;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport com.example.walktoshop.Login_SignUp.LogIn;\r\nimport com.example.walktoshop.Utils.NetworkController;\r\nimport com.example.walktoshop.R;\r\nimport com.example.walktoshop.Model.Discount;\r\nimport com.example.walktoshop.Utils.ViewAdapter;\r\nimport com.google.android.gms.location.FusedLocationProviderClient;\r\nimport com.google.android.gms.location.LocationServices;\r\nimport com.google.android.gms.tasks.OnCompleteListener;\r\nimport com.google.android.gms.tasks.OnSuccessListener;\r\nimport com.google.android.gms.tasks.Task;\r\nimport com.google.android.material.bottomnavigation.BottomNavigationView;\r\nimport com.google.android.material.floatingactionbutton.FloatingActionButton;\r\nimport com.google.firebase.auth.FirebaseAuth;\r\nimport com.google.firebase.firestore.DocumentSnapshot;\r\nimport com.google.firebase.firestore.FirebaseFirestore;;\r\n\r\nimport java.io.IOException;\r\nimport java.util.ArrayList;\r\nimport java.util.Calendar;\r\nimport java.util.Iterator;\r\nimport java.util.List;\r\n\r\n\r\npublic class UserView extends AppCompatActivity {\r\n    FirebaseFirestore db =FirebaseFirestore.getInstance();\r\n    private TextView alert;\r\n    private ListView homeListview;\r\n    private static final String CHANNEL_ID=\"StepCounter_notification_channel\";\r\n    private String userUID=null;\r\n    double latitude=0;\r\n    double longitude=0;\r\n    FloatingActionButton stepcounterFab;\r\n    String city=null;\r\n    LocationManager service;\r\n    LocationListener locationListener;\r\n    FusedLocationProviderClient fusedLocationClient;\r\n    private ArrayList<String> uidDiscount=new ArrayList<>();\r\n    private ArrayList<Discount> myDiscounts= new ArrayList<>();\r\n\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_user_view);\r\n        fusedLocationClient = LocationServices.getFusedLocationProviderClient(this);\r\n        alert=findViewById(R.id.alert);\r\n        alert.setVisibility(View.GONE);\r\n        stepcounterFab = (FloatingActionButton) findViewById(R.id.stepcounterFab);\r\n        stepcounterFab.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                startStepCounter();\r\n            }\r\n        });\r\n        BottomNavigationView bottomNavigationView = (BottomNavigationView) findViewById(R.id.bottom_navigation);\r\n        homeListview= findViewById(R.id.homeListView);\r\n        //setting del channel per quando partirà il service\r\n        localizeUser();\r\n        createNotificationChannel();\r\n        bottomNavigationView.setOnNavigationItemSelectedListener(new BottomNavigationView.OnNavigationItemSelectedListener() {\r\n            @Override\r\n            public boolean onNavigationItemSelected(@NonNull MenuItem item) {\r\n                switch (item.getItemId()) {\r\n                    case R.id.action_map:\r\n                        if(city==null && latitude==0 && longitude==0){\r\n                            Toast.makeText(UserView.this,\"Rilevamento della posizione in corso\",Toast.LENGTH_SHORT).show();\r\n                            askGPSpermission();\r\n                        }else{\r\n                            goToUserViewMap();\r\n                        }\r\n                        break;\r\n                    case R.id.action_statistics:\r\n                        goUserStatistics();\r\n                        break;\r\n                }\r\n                return true;\r\n            }\r\n        });\r\n        Intent intent =getIntent();\r\n        if(intent.hasExtra(\"UID\")){\r\n            this.userUID = intent.getStringExtra(\"UID\");\r\n        }\r\n    }\r\n    private void localizeUser(){\r\n        if(ActivityCompat.checkSelfPermission(UserView.this, Manifest.permission.ACCESS_FINE_LOCATION) == PackageManager.PERMISSION_GRANTED){\r\n            Task<Location> task = fusedLocationClient.getLastLocation();\r\n            task.addOnSuccessListener(new OnSuccessListener<Location>() {\r\n                @Override\r\n                public void onSuccess(Location location) {\r\n                    if(location != null){\r\n                        longitude = location.getLongitude();\r\n                        latitude = location.getLatitude();\r\n                        Log.d(\"longlat\",longitude+\"-\"+latitude);\r\n                        Geocoder geocoder=new Geocoder(UserView.this);\r\n                        List<Address> addresses=new ArrayList<>();\r\n                        try {\r\n                            addresses=geocoder.getFromLocation(latitude,longitude,1);\r\n                        } catch (IOException e) {\r\n                            e.printStackTrace();\r\n                        }\r\n                        city=addresses.get(0).getLocality();\r\n                        Log.d(\"city\",city);\r\n                    }\r\n                }\r\n            });\r\n        } else {\r\n\r\n            ActivityCompat.requestPermissions(UserView.this, new String[]{Manifest.permission.ACCESS_FINE_LOCATION}, 44);\r\n        }\r\n    }\r\n\r\n    private void goUserStatistics() {\r\n        final Intent intent = new Intent(UserView.this, UserStatistics.class);\r\n        intent.putExtra(\"UID\", this.userUID);\r\n        intent.putExtra(\"city\",city);\r\n        intent.putExtra(\"latitude\",latitude);\r\n        intent.putExtra(\"longitude\",longitude);\r\n        startActivity(intent);\r\n    }\r\n\r\n    @Override\r\n    protected void onStart() {\r\n        super.onStart();\r\n        NetworkController networkController =new NetworkController();\r\n        if(!networkController.isConnected(UserView.this)){\r\n            networkController.connectionDialog(UserView.this);\r\n        }\r\n        getUserDiscounts();\r\n    }\r\n\r\n    private void getUserDiscounts(){\r\n        db.collection(\"utente\").document(userUID).get().addOnCompleteListener(new OnCompleteListener<DocumentSnapshot>() {\r\n            @Override\r\n            public void onComplete(@NonNull Task<DocumentSnapshot> task) {\r\n                if(task.isSuccessful()){\r\n                    DocumentSnapshot document= task.getResult();\r\n                    ArrayList<String> discountUID = (ArrayList) document.get(\"discountUID\");\r\n                    if(discountUID!=null){\r\n                        UserView.this.uidDiscount=discountUID;\r\n                        getMyDiscounts(discountUID);\r\n                    }else  if(discountUID==null){\r\n                        alert.setVisibility(View.VISIBLE);\r\n                        alert.setText(\"Nessuno sconto attivato\");\r\n                    }else if(discountUID.isEmpty()){\r\n                        alert.setVisibility(View.VISIBLE);\r\n                        alert.setText(\"Nessuno sconto attivato\");\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n    private void getMyDiscounts(ArrayList discountUID){\r\n\r\n        if(!discountUID.isEmpty()){\r\n            int k=0;\r\n            Iterator it =discountUID.iterator();\r\n            while(it.hasNext()){\r\n                String uid= (String) it.next();\r\n                myDiscounts.clear();\r\n                int finalK = k;\r\n                db.collection(\"sconti\").document(uid).get().addOnCompleteListener(new OnCompleteListener<DocumentSnapshot>() {\r\n                    @Override\r\n                    public void onComplete(@NonNull Task<DocumentSnapshot> task) {\r\n                        if(task.isSuccessful()){\r\n                            DocumentSnapshot document= task.getResult();\r\n                            if(document.exists()){\r\n                                Discount discount=new Discount();\r\n                                discount.setUID(document.getString(\"uid\"));\r\n                                discount.setExpiringDate(document.getString(\"expiringDate\"));\r\n                                discount.setBusinessUID(document.getString(\"businessUID\"));\r\n                                discount.setDiscountsQuantity(document.getString(\"discountsQuantity\"));\r\n                                discount.setStartDiscountDate(document.getString(\"startDiscountDate\"));\r\n                                discount.setDescription(document.getString(\"description\"));\r\n                                if(Long.parseLong(discount.getExpiringDate()) > Calendar.getInstance().getTimeInMillis()) {\r\n                                    myDiscounts.add(discount);\r\n                                }\r\n                            }else{\r\n                                Log.d(\"non success\",finalK+\"\");\r\n                                discountUID.remove(finalK);\r\n                                deleteSharedPref((String) discountUID.get(finalK));\r\n\r\n                            }\r\n                            setUpdatedArray(discountUID);\r\n\r\n                        }\r\n                    }\r\n                }).addOnCompleteListener(new OnCompleteListener<DocumentSnapshot>() {\r\n                    @Override\r\n                    public void onComplete(@NonNull Task<DocumentSnapshot> task) {\r\n                        final ViewAdapter adapter=new ViewAdapter(UserView.this,myDiscounts, userUID,null,\"userHome\");\r\n                        homeListview.setAdapter(adapter);\r\n                    }\r\n                });\r\n                k++;\r\n            }\r\n        }\r\n    }\r\n    private void deleteSharedPref(String uid){\r\n        SharedPreferences prefs = getApplicationContext().getSharedPreferences(uid, MODE_PRIVATE);\r\n        SharedPreferences.Editor editor = prefs.edit();\r\n        editor.clear();\r\n        editor.apply();\r\n    }\r\n    private void setUpdatedArray(ArrayList<String> discountUID){\r\n        db.collection(\"utente\").document(UserView.this.userUID).update(\"discountUID\",discountUID);\r\n    }\r\n\r\n    private void goToUserViewMap() {\r\n        final Intent intent = new Intent(UserView.this, UserMapView.class);\r\n        intent.putExtra(\"UID\", this.userUID);\r\n        intent.putExtra(\"city\",city);\r\n        intent.putExtra(\"latitude\",latitude);\r\n        intent.putExtra(\"longitude\",longitude);\r\n        startActivity(intent);\r\n    }\r\n\r\n    public boolean onCreateOptionsMenu(Menu menu){\r\n        getMenuInflater().inflate(R.menu.menu_action_bar, menu);\r\n        return true;\r\n    }\r\n\r\n    public boolean onOptionsItemSelected(MenuItem item){\r\n        return super.onOptionsItemSelected(item);\r\n    }\r\n    private  void startStepCounter(){\r\n        if(userUID!=null  ){\r\n            Intent intent =new Intent(this, ServiceStepCounter.class);\r\n            if(isMyServiceRunning(ServiceStepCounter.class) == false){\r\n                Toast.makeText(this,\"Contapassi attivato\",Toast.LENGTH_SHORT).show();\r\n                intent.putExtra(\"UID\",userUID);\r\n                intent.putStringArrayListExtra(\"myDiscountsUID\",uidDiscount);\r\n                startService(intent);\r\n            }else{\r\n                Toast.makeText(this,\"Contapassi disattivato\",Toast.LENGTH_SHORT).show();\r\n                stopService(intent);\r\n            }\r\n        }\r\n    }\r\n    public void OnItemSelected(MenuItem item) {\r\n       if(item.getItemId() == R.id.action_exit){\r\n           logOut();\r\n       }\r\n    }\r\n\r\n    private void logOut(){\r\n        FirebaseAuth.getInstance().signOut();\r\n        final Intent intent = new Intent(this, LogIn.class);\r\n        startActivity(intent);\r\n        finish();\r\n    }\r\n    private void createNotificationChannel(){\r\n        if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.O) {\r\n            NotificationChannel serviceChannel = new NotificationChannel(\r\n                    CHANNEL_ID,\r\n                    \"StepCounter_notification_channel\",\r\n                    NotificationManager.IMPORTANCE_DEFAULT);\r\n            NotificationManager manager =getSystemService(NotificationManager.class);\r\n            manager.createNotificationChannel(serviceChannel);\r\n        }\r\n    }\r\n\r\n    private void killServiceIfRunning(){\r\n        if(isMyServiceRunning(ServiceStepCounter.class) == true){\r\n            Intent intent =new Intent(this, ServiceStepCounter.class);\r\n            Toast.makeText(this,\"Contapassi disattivato\",Toast.LENGTH_SHORT).show();\r\n            stopService(intent);\r\n        }\r\n    }\r\n    private boolean isMyServiceRunning(Class<?> serviceClass) {\r\n        ActivityManager manager = (ActivityManager) getSystemService(Context.ACTIVITY_SERVICE);\r\n        for (ActivityManager.RunningServiceInfo service : manager.getRunningServices(Integer.MAX_VALUE)) {\r\n            if (serviceClass.getName().equals(service.service.getClassName())) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    @Override\r\n    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {\r\n        if(requestCode == 44){\r\n            if(grantResults.length > 0 && grantResults[0] == PackageManager.PERMISSION_GRANTED){\r\n\r\n            }\r\n        }else if(requestCode==10){\r\n            if(grantResults.length>0 && grantResults[0]==PackageManager.PERMISSION_GRANTED){\r\n            }else if(grantResults[0]==PackageManager.PERMISSION_DENIED){\r\n                if(ActivityCompat.shouldShowRequestPermissionRationale(UserView.this,Manifest.permission.ACCESS_FINE_LOCATION)){\r\n                    //dialog in cui spiego\r\n                    new AlertDialog.Builder(UserView.this)\r\n                            .setTitle(\"Permission\")\r\n                            .setMessage(\"Denying permission you can't use geo-localization\")\r\n                            .setNeutralButton(\"ok\",null)\r\n                            .show();\r\n                }\r\n            }\r\n        }\r\n    }\r\n    //debug mode\r\n    private void getUserPosition() {\r\n        service = (LocationManager) getSystemService(LOCATION_SERVICE);\r\n        locationListener = new LocationListener() {\r\n            @Override\r\n            public void onLocationChanged(@NonNull Location location) {\r\n                latitude=location.getLatitude();\r\n                longitude=location.getLongitude();\r\n                Log.d(\"coordinates\",latitude+\"\\n\"+longitude);\r\n                try {\r\n                    Geocoder geocoder=new Geocoder(UserView.this);\r\n                    List<Address> addresses=new ArrayList<>();\r\n                    addresses=geocoder.getFromLocation(latitude,longitude,1);\r\n                    String country=addresses.get(0).getCountryName();\r\n                    city=addresses.get(0).getLocality();\r\n                    goToUserViewMap();\r\n                    //Log.d(\"city\",city);\r\n                } catch (IOException e) {\r\n                    e.printStackTrace();\r\n                }\r\n            }\r\n\r\n            @Override\r\n            public void onProviderEnabled(@NonNull String provider) {\r\n\r\n            }\r\n\r\n            @Override\r\n            public void onProviderDisabled(@NonNull String provider) {\r\n                new AlertDialog.Builder(UserView.this).setTitle(\"GPS dialog\").setMessage(\"Do you want to turn on gps?\")\r\n                        .setPositiveButton(\"Yes\", new DialogInterface.OnClickListener() {\r\n                            @Override\r\n                            public void onClick(DialogInterface dialogInterface, int i) {\r\n                                Intent intent = new Intent(Settings.ACTION_LOCATION_SOURCE_SETTINGS);\r\n                                startActivity(intent);\r\n                            }\r\n                        }).setNegativeButton(\"Go Back\", null).show();\r\n            }\r\n        };\r\n    }\r\n\r\n    private void askGPSpermission() {\r\n        if (ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) != PackageManager.PERMISSION_GRANTED && ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_COARSE_LOCATION) != PackageManager.PERMISSION_GRANTED) {\r\n            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {\r\n                requestPermissions(new String[]{Manifest.permission.ACCESS_FINE_LOCATION,Manifest.permission.ACCESS_COARSE_LOCATION,Manifest.permission.INTERNET},10);\r\n            }\r\n            return;\r\n        }\r\n        getUserPosition();\r\n        service.requestLocationUpdates(\"gps\", 500, 1000, locationListener);\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/walktoshop/User/UserView.java	(revision 9f2b292f2f2efab664a5a56c7c4b7a1bdd29ab70)
+++ app/src/main/java/com/example/walktoshop/User/UserView.java	(date 1612266308452)
@@ -22,6 +22,7 @@
 import android.os.Bundle;
 import android.provider.Settings;
 import android.util.Log;
+import android.view.Gravity;
 import android.view.Menu;
 import android.view.MenuItem;
 import android.view.View;
@@ -236,6 +237,8 @@
     }
 
     private void goToUserViewMap() {
+        Toast toast = Toast.makeText(getApplicationContext(),"Apertura mappa in corso",Toast.LENGTH_SHORT);
+        toast.show();
         final Intent intent = new Intent(UserView.this, UserMapView.class);
         intent.putExtra("UID", this.userUID);
         intent.putExtra("city",city);
Index: app/src/main/java/com/example/walktoshop/Seller/SellerView.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.walktoshop.Seller;\r\n\r\nimport android.app.AlertDialog;\r\nimport android.content.DialogInterface;\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\nimport android.util.Log;\r\nimport android.view.Menu;\r\nimport android.view.MenuItem;\r\nimport android.view.View;\r\nimport android.widget.ImageButton;\r\nimport android.widget.ImageView;\r\nimport android.widget.ListView;\r\nimport android.widget.ProgressBar;\r\nimport android.widget.TextView;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.annotation.Nullable;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\n\r\nimport com.example.walktoshop.Login_SignUp.LogIn;\r\nimport com.example.walktoshop.Model.Discount;\r\nimport com.example.walktoshop.Utils.NetworkController;\r\nimport com.example.walktoshop.R;\r\nimport com.example.walktoshop.Utils.ViewAdapter;\r\nimport com.google.android.gms.tasks.OnCompleteListener;\r\nimport com.google.android.gms.tasks.Task;\r\nimport com.google.android.material.floatingactionbutton.FloatingActionButton;\r\nimport com.google.firebase.auth.FirebaseAuth;\r\nimport com.google.firebase.firestore.DocumentSnapshot;\r\nimport com.google.firebase.firestore.FirebaseFirestore;\r\n\r\nimport java.util.ArrayList;\r\n\r\npublic class SellerView extends AppCompatActivity {\r\n    private ListView listView;\r\n    private TextView alert;\r\n    private String UID=null;\r\n    private ProgressBar progressBar;\r\n    private FloatingActionButton addActivityButton;\r\n    private ImageButton editDiscount;\r\n    private ImageButton deleteDiscount;\r\n    FirebaseFirestore db =FirebaseFirestore.getInstance();\r\n    private ArrayList<Discount> discountArray=new ArrayList<>();\r\n    private ArrayList<String> businessUID =new ArrayList<>();\r\n    private ArrayList<String> discountUID = new ArrayList<>();\r\n    private FloatingActionButton mFab;\r\n    private  ImageView discountImage;\r\n    private TextView scontiAttivita;\r\n\r\n    @Override\r\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_seller_view);\r\n        alert = (TextView) findViewById(R.id.alertSeller);\r\n        //View coordinatorLayout = findViewById(android.R.id.content);\r\n        addActivityButton=(FloatingActionButton)findViewById(R.id.addBusinessFab);\r\n        scontiAttivita = (TextView) findViewById(R.id.scontiAttivita);\r\n        discountImage = findViewById(R.id.discountImage);\r\n        addActivityButton.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                goSellerMapView();\r\n                addActivityButton.setVisibility(View.INVISIBLE);\r\n            }\r\n        });\r\n        mFab = (FloatingActionButton) findViewById(R.id.fab);\r\n        mFab.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                startManageDiscount();\r\n            }\r\n        });\r\n        progressBar=findViewById(R.id.sellerViewProgressBar);\r\n        listView=findViewById(R.id.listView);\r\n        Intent intent = getIntent();\r\n        if(intent.hasExtra(\"UID\")){\r\n            UID=intent.getStringExtra(\"UID\");\r\n        }\r\n    }\r\n\r\n    @Override\r\n    protected void onStart() {\r\n        super.onStart();\r\n        NetworkController networkController =new NetworkController();\r\n        if(!networkController.isConnected(SellerView.this)){\r\n            networkController.connectionDialog(SellerView.this);\r\n        }\r\n        getSellerBusinessUID();\r\n        if(businessUID == null){\r\n            businessUID = new ArrayList<String>();\r\n        }\r\n        if(discountUID==null){\r\n            addActivityButton.setVisibility(View.INVISIBLE);\r\n        }else if(discountUID.isEmpty()){\r\n            Log.d(\"bi\",discountUID.toString());\r\n            addActivityButton.setVisibility(View.INVISIBLE);\r\n            if(businessUID.size()<= 0){\r\n                Log.d(\"Busi\", String.valueOf(businessUID.size()));\r\n                addActivityButton.setVisibility(View.VISIBLE);\r\n                discountImage.setVisibility(View.GONE);\r\n                scontiAttivita.setVisibility(View.GONE);\r\n                alert.setText(\"Nessuna attività registrata\");\r\n                mFab.setVisibility(View.GONE);\r\n\r\n            }\r\n        }\r\n    }\r\n\r\n    public boolean onCreateOptionsMenu(Menu menu){\r\n        getMenuInflater().inflate(R.menu.menu_action_bar, menu);\r\n        return true;\r\n    }\r\n\r\n    public boolean onOptionsItemSelected(MenuItem item){\r\n        return super.onOptionsItemSelected(item);\r\n    }\r\n    public void OnItemSelected(MenuItem item) {\r\n        if(item.getItemId() == R.id.action_exit){\r\n            logOut();\r\n        }\r\n    }\r\n\r\n    private void getSellerBusinessUID(){\r\n        if(UID!=null){\r\n            db.collection(\"venditore\").document(this.UID).get().addOnCompleteListener(new OnCompleteListener<DocumentSnapshot>() {\r\n                @Override\r\n                public void onComplete(@NonNull Task<DocumentSnapshot> task) {\r\n                    if(task.isSuccessful()){\r\n                        DocumentSnapshot document= task.getResult();\r\n                        businessUID= (ArrayList) document.get(\"businessUID\");\r\n                        //se ha delle attività le recupera\r\n                        //Log.d(\"businessUID\", String.valueOf(businessUID.size()));\r\n                        if(businessUID!=null){\r\n                            progressBar.setVisibility(View.VISIBLE);\r\n                            getBusiness();\r\n                            progressBar.setVisibility(View.INVISIBLE);\r\n                        }else{\r\n                            alert.setText(\"Nessuna attività registrata\");\r\n                            addActivityButton.setVisibility(View.VISIBLE);\r\n                            progressBar.setVisibility(View.INVISIBLE);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n    private void getBusiness(){\r\n        if(businessUID!=null && !businessUID.isEmpty()){\r\n            addActivityButton.setVisibility(View.INVISIBLE);\r\n            scontiAttivita.setVisibility(View.VISIBLE);\r\n            discountImage.setVisibility(View.VISIBLE);\r\n            mFab.setVisibility(View.VISIBLE);\r\n            for(int i=0;i<businessUID.size();i++){\r\n                String b=businessUID.get(i);\r\n                Log.d(\"b\",b);\r\n                db.collection(\"attivita\").document(b).get().addOnCompleteListener(new OnCompleteListener<DocumentSnapshot>() {\r\n                    @Override\r\n                    public void onComplete(@NonNull Task<DocumentSnapshot> task) {\r\n                        if(task.isSuccessful()){\r\n                            DocumentSnapshot document= task.getResult();\r\n                            if (document.exists()) {\r\n                                //Log.d(\"TAG\", \"DocumentSnapshot data: \" + document.getData());\r\n                                discountUID=(ArrayList) document.get(\"discountUID\");\r\n                                //Log.d(\"TAG\", \"uid dello sconto\" + discountUID.toString());\r\n                                if(discountUID!=null && !discountUID.isEmpty()){\r\n                                    getDiscounts();\r\n                                }else{\r\n                                    alert.setText(\"Nessuno sconto disponibile\");\r\n                                    alert.setVisibility(View.VISIBLE);\r\n                                    final ViewAdapter adapter=new ViewAdapter(SellerView.this,discountArray, UID,businessUID,\"sellerHome\");\r\n                                    listView.setAdapter(adapter);\r\n                                }\r\n                            } else {\r\n                                Log.d(\"TAG\", \"No such document\");\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    }\r\n    private void getDiscounts(){\r\n        discountArray.clear();\r\n            for(int k=0;k<discountUID.size();k++){\r\n                db.collection(\"sconti\").document(discountUID.get(k)).get().addOnCompleteListener(new OnCompleteListener<DocumentSnapshot>() {\r\n                    @Override\r\n                    public void onComplete(@NonNull Task<DocumentSnapshot> task) {\r\n                        if(task.isSuccessful()){\r\n                            Discount discount=new Discount();\r\n                            DocumentSnapshot document=task.getResult();\r\n                            discount.setUID(document.getString(\"uid\"));\r\n                            discount.setBusinessUID(document.getString(\"businessUID\"));\r\n                            discount.setStartDiscountDate(document.getString(\"startDiscountDate\"));\r\n                            discount.setExpiringDate(document.getString(\"expiringDate\"));\r\n                            discount.setDescription(document.getString(\"description\"));\r\n                            discount.setDiscountsQuantity(document.getString(\"discountsQuantity\"));\r\n                            discountArray.add(discount);\r\n                        }else{\r\n\r\n                        }\r\n                    }\r\n                }).addOnCompleteListener(new OnCompleteListener<DocumentSnapshot>() {\r\n                    @Override\r\n                    public void onComplete(@NonNull Task<DocumentSnapshot> task) {\r\n                        final ViewAdapter adapter=new ViewAdapter(SellerView.this,discountArray, UID,businessUID,\"sellerHome\");\r\n                        listView.setAdapter(adapter);\r\n                    }\r\n                });\r\n            }\r\n    }\r\n    private void dialog(){\r\n        AlertDialog.Builder builder = new AlertDialog.Builder(this);\r\n        // Add the buttons\r\n        builder.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {\r\n            public void onClick(DialogInterface dialog, int id) {\r\n                // User clicked OK button\r\n                goSellerMapView();\r\n\r\n            }\r\n        }).setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {\r\n            public void onClick(DialogInterface dialog, int id) {\r\n                // User cancelled the dialog\r\n            }\r\n        }).setMessage(R.string.emptyBusiness);\r\n        // Set other d\r\n        builder.show();\r\n    }\r\n    private void goSellerMapView(){\r\n        final Intent intent = new Intent(this, SellerMapView.class);\r\n        intent.putExtra(\"UID\",UID);\r\n        startActivity(intent);\r\n    }\r\n    private void startManageDiscount(){\r\n        final Intent intent = new Intent(this, ManageDiscount.class);\r\n        intent.putExtra(\"businessUID\",businessUID.get(0));\r\n        //Log.d(\"u\",businessUID.get(0).toString());\r\n        startActivity(intent);\r\n    }\r\n\r\n    private void logOut(){\r\n        FirebaseAuth.getInstance().signOut();\r\n        final Intent intent = new Intent(this, LogIn.class);\r\n        startActivity(intent);\r\n        finish();\r\n    }\r\n}\r\n\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/walktoshop/Seller/SellerView.java	(revision 9f2b292f2f2efab664a5a56c7c4b7a1bdd29ab70)
+++ app/src/main/java/com/example/walktoshop/Seller/SellerView.java	(date 1612265899826)
@@ -36,6 +36,7 @@
     private ListView listView;
     private TextView alert;
     private String UID=null;
+    private int counter= 0;
     private ProgressBar progressBar;
     private FloatingActionButton addActivityButton;
     private ImageButton editDiscount;
@@ -89,21 +90,20 @@
         getSellerBusinessUID();
         if(businessUID == null){
             businessUID = new ArrayList<String>();
-        }
-        if(discountUID==null){
-            addActivityButton.setVisibility(View.INVISIBLE);
-        }else if(discountUID.isEmpty()){
-            Log.d("bi",discountUID.toString());
-            addActivityButton.setVisibility(View.INVISIBLE);
-            if(businessUID.size()<= 0){
-                Log.d("Busi", String.valueOf(businessUID.size()));
-                addActivityButton.setVisibility(View.VISIBLE);
-                discountImage.setVisibility(View.GONE);
-                scontiAttivita.setVisibility(View.GONE);
-                alert.setText("Nessuna attività registrata");
-                mFab.setVisibility(View.GONE);
-
-            }
+        }else if(businessUID.size()<= 0){
+            counter++;
+            addActivityButton.setVisibility(View.VISIBLE);
+            discountImage.setVisibility(View.GONE);
+            scontiAttivita.setVisibility(View.GONE);
+            alert.setText("Nessuna attività registrata");
+            if(counter == 1)
+                dialog();
+            addActivityButton.setVisibility(View.VISIBLE);
+            mFab.setVisibility(View.GONE);
+        }else if(discountUID==null){
+            addActivityButton.setVisibility(View.INVISIBLE);
+        }else if(discountUID.isEmpty()){
+            addActivityButton.setVisibility(View.INVISIBLE);
         }
     }
 
@@ -196,8 +196,6 @@
                             discount.setDescription(document.getString("description"));
                             discount.setDiscountsQuantity(document.getString("discountsQuantity"));
                             discountArray.add(discount);
-                        }else{
-
                         }
                     }
                 }).addOnCompleteListener(new OnCompleteListener<DocumentSnapshot>() {
@@ -212,15 +210,9 @@
     private void dialog(){
         AlertDialog.Builder builder = new AlertDialog.Builder(this);
         // Add the buttons
-        builder.setPositiveButton(R.string.yes, new DialogInterface.OnClickListener() {
+        builder.setPositiveButton(R.string.ok, new DialogInterface.OnClickListener() {
             public void onClick(DialogInterface dialog, int id) {
                 // User clicked OK button
-                goSellerMapView();
-
-            }
-        }).setNegativeButton(R.string.no, new DialogInterface.OnClickListener() {
-            public void onClick(DialogInterface dialog, int id) {
-                // User cancelled the dialog
             }
         }).setMessage(R.string.emptyBusiness);
         // Set other d
Index: app/src/main/res/layout/activity_managediscount.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<LinearLayout\r\n    android:layout_height=\"match_parent\"\r\n    android:layout_width=\"match_parent\" xmlns:tools=\"http://schemas.android.com/tools\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    android:orientation=\"vertical\"\r\n    android:background=\"@color/white_ice\">\r\n\r\n    <ImageView\r\n        android:id=\"@+id/discountImage\"\r\n        android:layout_gravity=\"center\"\r\n        android:layout_width=\"300dp\"\r\n        android:layout_height=\"190dp\"\r\n        android:src=\"@drawable/_0943903\"/>\r\n\r\n\r\n    <EditText\r\n        android:layout_marginTop=\"75dp\"\r\n        android:id=\"@+id/description\"\r\n        android:layout_width=\"317dp\"\r\n        android:layout_gravity=\"center\"\r\n        android:textColor=\"@color/black\"\r\n        android:layout_height=\"54dp\"\r\n        android:background=\"@drawable/ic_text_box\"\r\n        android:drawableTint=\"@color/verde_maggio\"\r\n        android:drawableStart=\"@drawable/ic_description\"\r\n        android:drawablePadding=\"4dp\"\r\n        android:elevation=\"6dp\"\r\n        android:ems=\"10\"\r\n        android:hint=\"@string/description\"\r\n        android:paddingStart=\"6dp\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\"\r\n        app:layout_constraintVertical_bias=\"0.394\" />\r\n\r\n    <EditText\r\n        android:id=\"@+id/disocuntsQuantity\"\r\n        android:layout_width=\"317dp\"\r\n        android:layout_height=\"54dp\"\r\n        android:layout_gravity=\"center\"\r\n        android:layout_marginTop=\"30dp\"\r\n        android:background=\"@drawable/ic_text_box\"\r\n        android:drawableStart=\"@drawable/ic_walk\"\r\n        android:drawablePadding=\"4dp\"\r\n        android:elevation=\"6dp\"\r\n        android:ems=\"10\"\r\n        android:drawableTint=\"@color/verde_maggio\"\r\n        android:hint=\"@string/disocuntsQuantity\"\r\n        android:inputType=\"number\"\r\n        android:paddingStart=\"6dp\"\r\n        android:textColor=\"@color/black\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\"\r\n        app:tint=\"@color/verde_maggio\" />\r\n\r\n    <LinearLayout\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_gravity=\"center\"\r\n        android:orientation=\"horizontal\"\r\n        android:layout_marginTop=\"30dp\"\r\n        android:layout_marginRight=\"7dp\">\r\n\r\n        <ImageButton\r\n            android:id=\"@+id/addDate\"\r\n            android:layout_width=\"62dp\"\r\n            android:layout_height=\"44dp\"\r\n            app:tint=\"@color/verde_maggio\"\r\n            android:background=\"@color/white_ice\"\r\n            android:drawableStart=\"@drawable/ic_calendar\"\r\n            android:src=\"@android:drawable/ic_menu_my_calendar\" />\r\n\r\n        <EditText\r\n            android:id=\"@+id/expiringDate\"\r\n            android:layout_width=\"270dp\"\r\n            android:layout_height=\"wrap_content\" android:textColor=\"@color/black\"\r\n            android:background=\"@drawable/ic_text_box\"\r\n            android:elevation=\"6dp\"\r\n            android:hint=\"@string/expiringDate\"\r\n            android:textSize=\"25dp\"\r\n            />\r\n    </LinearLayout>\r\n    <Button\r\n        android:layout_marginTop=\"30dp\"\r\n        android:layout_marginRight=\"20dp\"\r\n        android:layout_gravity=\"bottom|end\"\r\n        android:id=\"@+id/add\"\r\n        android:background=\"@color/verde_maggio\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:text=\"@string/add\"\r\n        />\r\n\r\n\r\n</LinearLayout>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/activity_managediscount.xml	(revision 9f2b292f2f2efab664a5a56c7c4b7a1bdd29ab70)
+++ app/src/main/res/layout/activity_managediscount.xml	(date 1612262231090)
@@ -11,8 +11,7 @@
         android:id="@+id/discountImage"
         android:layout_gravity="center"
         android:layout_width="300dp"
-        android:layout_height="190dp"
-        android:src="@drawable/_0943903"/>
+        android:layout_height="190dp" />
 
 
     <EditText
Index: app/src/main/res/layout/activity_seller_view.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.coordinatorlayout.widget.CoordinatorLayout\r\n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    android:id=\"@+id/sellerViewcontainer\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    android:background=\"@color/white_ice\">\r\n\r\n    <TextView\r\n        android:id=\"@+id/alertSeller\"\r\n        android:layout_gravity=\"center\"\r\n        android:layout_marginTop=\"100dp\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:textSize=\"25dp\"/>\r\n\r\n        <LinearLayout\r\n            android:id=\"@+id/sellerLinearLayout\"\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:orientation=\"vertical\">\r\n\r\n            <ImageView\r\n                android:id=\"@+id/sellerImage\"\r\n                android:layout_width=\"300dp\"\r\n                android:layout_gravity=\"center\"\r\n                android:layout_height=\"190dp\"\r\n                android:src=\"@drawable/_0943903\"/>\r\n\r\n            <LinearLayout\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:orientation=\"horizontal\"\r\n                android:padding=\"16dp\">\r\n\r\n                <ImageView\r\n                    android:id=\"@+id/discountImage\"\r\n                    android:layout_width=\"wrap_content\"\r\n                    android:layout_height=\"wrap_content\"\r\n                    android:layout_gravity=\"center\"\r\n                    android:src=\"@drawable/ic_baseline_local_offer_24\"\r\n                    app:tint=\"@color/black\"/>\r\n\r\n                <TextView\r\n                    android:id=\"@+id/scontiAttivita\"\r\n                    android:layout_width=\"wrap_content\"\r\n                    android:layout_height=\"wrap_content\"\r\n                    android:text=\"Sconti Attività\"\r\n                    android:textColor=\"@color/black\"\r\n                    android:textStyle=\"bold\"\r\n                    android:textAppearance=\"?attr/textAppearanceHeadline4\"/>\r\n\r\n            </LinearLayout>\r\n\r\n            <LinearLayout\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"match_parent\"\r\n                android:orientation=\"vertical\">\r\n\r\n               <ListView\r\n                    android:id=\"@+id/listView\"\r\n                    android:layout_width=\"match_parent\"\r\n                    android:layout_height=\"match_parent\"\r\n                    android:layout_alignParentStart=\"true\"\r\n                    android:layout_alignParentLeft=\"true\"\r\n                    android:layout_alignParentTop=\"true\"\r\n                    android:layout_alignParentEnd=\"true\"\r\n                    android:layout_alignParentRight=\"true\"\r\n                    android:layout_alignParentBottom=\"true\"\r\n                    android:clickable=\"false\"\r\n                    android:focusable=\"false\">\r\n                </ListView>\r\n\r\n            </LinearLayout>\r\n        </LinearLayout>\r\n\r\n\r\n    <com.google.android.material.floatingactionbutton.FloatingActionButton\r\n        android:id=\"@+id/addBusinessFab\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_gravity=\"bottom|right\"\r\n        android:layout_marginRight=\"@dimen/material_bottom_margin\"\r\n        android:layout_marginBottom=\"@dimen/material_botton_margin\"\r\n        android:src=\"@drawable/ic_add_location\"\r\n        app:tint=\"@color/white\"\r\n        app:backgroundTint=\"@color/verde_maggio\"\r\n        app:backgroundTintMode=\"src_over\"\r\n        app:fabSize=\"normal\"\r\n        app:rippleColor=\"#00FF00\" />\r\n    <ProgressBar\r\n        android:id=\"@+id/sellerViewProgressBar\"\r\n        style=\"?android:attr/progressBarStyle\"\r\n        android:layout_width=\"91dp\"\r\n        android:layout_height=\"81dp\"\r\n        android:layout_marginLeft=\"160dp\"\r\n        android:layout_marginTop=\"350dp\" />\r\n\r\n    <com.google.android.material.floatingactionbutton.FloatingActionButton\r\n        android:id=\"@+id/fab\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_gravity=\"bottom|right\"\r\n        android:layout_marginRight=\"@dimen/material_bottom_margin\"\r\n        android:layout_marginBottom=\"@dimen/material_botton_margin\"\r\n        android:longClickable=\"true\"\r\n        android:src=\"@drawable/ic_add_white\"\r\n        app:tint=\"@color/white\"\r\n        app:backgroundTint=\"@color/verde_maggio\"\r\n        app:backgroundTintMode=\"src_in\"\r\n        app:fabSize=\"normal\"\r\n        app:navigationIcon=\"@drawable/ic_add_white\"\r\n        app:rippleColor=\"#00FF00\" />\r\n\r\n</androidx.coordinatorlayout.widget.CoordinatorLayout>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/activity_seller_view.xml	(revision 9f2b292f2f2efab664a5a56c7c4b7a1bdd29ab70)
+++ app/src/main/res/layout/activity_seller_view.xml	(date 1612262231085)
@@ -25,8 +25,7 @@
                 android:id="@+id/sellerImage"
                 android:layout_width="300dp"
                 android:layout_gravity="center"
-                android:layout_height="190dp"
-                android:src="@drawable/_0943903"/>
+                android:layout_height="190dp" />
 
             <LinearLayout
                 android:layout_width="match_parent"
Index: app/src/main/res/layout/activity_user_view.xml
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+><?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.coordinatorlayout.widget.CoordinatorLayout\r\n    xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    android:id=\"@+id/userCoordinatorLayout\"\r\n    android:background=\"@color/white_ice\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\">\r\n\r\n    <ProgressBar\r\n        android:id=\"@+id/sellerViewProgressBar\"\r\n        style=\"?android:attr/progressBarStyle\"\r\n        android:layout_width=\"91dp\"\r\n        android:layout_height=\"81dp\"\r\n        android:layout_marginLeft=\"160dp\"\r\n        android:layout_marginTop=\"250dp\"\r\n        android:visibility=\"gone\"/>\r\n    <TextView\r\n        android:id=\"@+id/alert\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_marginTop=\"100dp\"\r\n        android:layout_marginLeft=\"55dp\"\r\n        android:layout_gravity=\"center\"\r\n        android:text=\"Nessuno sconto attivato\"\r\n        android:textSize=\"25dp\"\r\n        android:visibility=\"gone\"/>\r\n\r\n\r\n    <LinearLayout\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:orientation=\"vertical\">\r\n\r\n\r\n        <ImageView\r\n            android:id=\"@+id/userImage\"\r\n            android:layout_width=\"300dp\"\r\n            android:layout_gravity=\"center\"\r\n            android:layout_height=\"190dp\"\r\n            android:src=\"@drawable/_707919\"/>\r\n\r\n        <LinearLayout\r\n            android:layout_width=\"match_parent\"\r\n            android:layout_height=\"wrap_content\"\r\n            android:orientation=\"vertical\">\r\n            <LinearLayout\r\n                android:id=\"@+id/linearTitleLayout\"\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:orientation=\"horizontal\"\r\n                android:padding=\"16dp\">\r\n                <ImageView\r\n                    android:layout_width=\"wrap_content\"\r\n                    android:layout_height=\"wrap_content\"\r\n                    android:layout_gravity=\"center\"\r\n                    android:src=\"@drawable/ic_baseline_local_offer_24\"\r\n                    app:tint=\"@color/black\"/>\r\n\r\n                <TextView\r\n                    android:id=\"@+id/scontiAttivita\"\r\n                    android:layout_width=\"wrap_content\"\r\n                    android:layout_height=\"wrap_content\"\r\n                    android:textColor=\"@color/black\"\r\n                    android:textStyle=\"bold\"\r\n                    android:text=\"Sconti Attivi\"\r\n                    android:textAppearance=\"?attr/textAppearanceHeadline4\"/>\r\n            </LinearLayout>\r\n\r\n\r\n            <ListView\r\n                android:id=\"@+id/homeListView\"\r\n                android:layout_width=\"match_parent\"\r\n                android:layout_height=\"wrap_content\"\r\n                android:layout_marginBottom=\"65dp\"/>\r\n        </LinearLayout>\r\n    </LinearLayout>\r\n    <com.google.android.material.bottomnavigation.BottomNavigationView\r\n        android:id=\"@+id/bottom_navigation\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_gravity=\"bottom\"\r\n        style=\"@style/Widget.MaterialComponents.BottomNavigationView.Colored\"\r\n        app:menu=\"@menu/menu_bottom_navigation_view\"/>\r\n\r\n    <com.google.android.material.floatingactionbutton.FloatingActionButton\r\n        android:id=\"@+id/stepcounterFab\"\r\n        android:src=\"@drawable/ic_footsteps_silhouette_variant_svgrepo_com\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        app:backgroundTint=\"@color/verde_maggio\"\r\n        app:backgroundTintMode=\"src_over\"\r\n        app:fabSize=\"normal\"\r\n        app:rippleColor=\"#00FF00\"\r\n        app:tint=\"@color/white\"\r\n        android:layout_marginRight=\"@dimen/material_bottom_margin\"\r\n        android:layout_marginBottom=\"@dimen/material_botton_margin\"\r\n        app:layout_anchor=\"@+id/linearTitleLayout\"\r\n        app:layout_anchorGravity=\"bottom|right\"/>\r\n</androidx.coordinatorlayout.widget.CoordinatorLayout>
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/res/layout/activity_user_view.xml	(revision 9f2b292f2f2efab664a5a56c7c4b7a1bdd29ab70)
+++ app/src/main/res/layout/activity_user_view.xml	(date 1612262231076)
@@ -37,8 +37,7 @@
             android:id="@+id/userImage"
             android:layout_width="300dp"
             android:layout_gravity="center"
-            android:layout_height="190dp"
-            android:src="@drawable/_707919"/>
+            android:layout_height="190dp" />
 
         <LinearLayout
             android:layout_width="match_parent"
Index: app/src/main/java/com/example/walktoshop/Seller/ManageDiscount.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.walktoshop.Seller;\r\n\r\n\r\nimport android.app.DatePickerDialog;\r\nimport android.content.Intent;\r\nimport android.os.Bundle;\r\nimport android.util.Log;\r\nimport android.view.Gravity;\r\nimport android.view.MenuItem;\r\nimport android.view.View;\r\nimport android.widget.Button;\r\nimport android.widget.DatePicker;\r\nimport android.widget.EditText;\r\nimport android.widget.ImageButton;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.annotation.Nullable;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\n\r\nimport com.example.walktoshop.Model.Discount;\r\nimport com.example.walktoshop.Utils.NetworkController;\r\nimport com.example.walktoshop.R;\r\nimport com.google.android.gms.tasks.OnCompleteListener;\r\nimport com.google.android.gms.tasks.Task;\r\nimport com.google.firebase.firestore.DocumentSnapshot;\r\nimport com.google.firebase.firestore.FirebaseFirestore;\r\n\r\nimport java.text.ParseException;\r\nimport java.text.SimpleDateFormat;\r\nimport java.util.ArrayList;\r\nimport java.util.Calendar;\r\nimport java.util.Date;\r\nimport java.util.regex.Pattern;\r\n\r\npublic class ManageDiscount extends AppCompatActivity {\r\n    FirebaseFirestore db = FirebaseFirestore.getInstance();\r\n    private String businessUID=null;\r\n    private EditText description;\r\n    private EditText quantity;\r\n    private TextView expiringDate;\r\n    private Button add;\r\n    private ImageButton addDate;\r\n    private Calendar cal;\r\n    private String dateEditText;\r\n    private String[] separetedDate;\r\n    private boolean fromEditText;\r\n    int date;\r\n    long expiringDateInMillis;\r\n    String stringedDescription;\r\n    String todayInMills;\r\n    String stringedQuantity;\r\n\r\n    //DatePickerDialog.OnDateSetListener listener;\r\n\r\n    @Override\r\n    protected void onCreate(@Nullable Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_managediscount);\r\n        getSupportActionBar().setDisplayHomeAsUpEnabled(true);\r\n        getSupportActionBar().setHomeButtonEnabled(true);\r\n        Intent intent=getIntent();\r\n        if(intent.hasExtra(\"businessUID\")){\r\n            this.businessUID=intent.getStringExtra(\"businessUID\");\r\n        }\r\n        //inizializzazione variabli\r\n        addDate=(ImageButton)findViewById(R.id.addDate);\r\n        expiringDate=(TextView) findViewById(R.id.expiringDate);\r\n        description=(EditText)findViewById(R.id.description);\r\n        quantity=(EditText)findViewById(R.id.disocuntsQuantity);\r\n        add=(Button)findViewById(R.id.add);\r\n        //setting date picker\r\n        cal=Calendar.getInstance();\r\n        this.todayInMills=getTodayInMills();\r\n        expiringDate.setEnabled(false);\r\n        //\r\n        addDate.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                //metodo set datepicker\r\n                date=cal.get(Calendar.DATE);\r\n                int month=cal.get(Calendar.MONTH);\r\n                Log.d(\"month\", String.valueOf(month));\r\n                int year=cal.get(Calendar.YEAR);\r\n                if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.N) {\r\n                    expiringDate.setEnabled(false);\r\n                    fromEditText = false;\r\n                    DatePickerDialog datePickerDialog=new DatePickerDialog(ManageDiscount.this, android.R.style.Theme_DeviceDefault_Dialog, new DatePickerDialog.OnDateSetListener() {\r\n                        @Override\r\n                        public void onDateSet(DatePicker datePicker, int year, int month, int date) {\r\n                            month = month + 1;\r\n                            String dateFormat = null;\r\n                            if(month < 10 ){\r\n                                if (date < 10){\r\n                                    dateFormat=\"0\"+date+\"/\"+\"0\"+month+\"/\"+year;\r\n                                } else {\r\n                                    dateFormat=date+\"/\"+\"0\"+month+\"/\"+year;\r\n                                }\r\n\r\n                            } else {\r\n                                if (date < 10){\r\n                                    dateFormat = \"0\"+date+\"/\"+month+\"/\"+year;\r\n                                } else{\r\n                                    dateFormat = date+\"/\"+month+\"/\"+year;\r\n                                }\r\n                            }\r\n\r\n                            Date date1 = null;\r\n                            try {\r\n                                date1 = new SimpleDateFormat(\"dd/MM/yyyy\").parse(dateFormat);\r\n                            } catch (ParseException e) {\r\n                                e.printStackTrace();\r\n                            }\r\n                            Log.d(\"data\",dateFormat);\r\n                            expiringDate.setText(dateFormat);\r\n\r\n                            ManageDiscount.this.expiringDateInMillis =  date1.getTime();\r\n                        }\r\n                    },year,month,date);\r\n                    datePickerDialog.show();\r\n                }else{\r\n                    Toast toast = Toast.makeText(ManageDiscount.this,\"Inserire la data manualmente, poichè la versione del tuo dispositivo non supporta l'inserimento automatico tramite calendario\",Toast.LENGTH_LONG);\r\n                    toast.setGravity(Gravity.CENTER, 0, 0);\r\n                    toast.show();\r\n                    expiringDate.setEnabled(true);\r\n                    expiringDate.setHint(\"Data di scadenza(gg/mm/aaaa)\");\r\n                    fromEditText = true;\r\n                }\r\n            }\r\n        });\r\n\r\n\r\n\r\n        add.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View view) {\r\n                if(checkInfo()){\r\n                    Discount discount= new Discount();\r\n                    String customDiscountUID=calculateMyCustomDiscountUID(businessUID,expiringDateInMillis);\r\n                    discount.setUID(customDiscountUID);\r\n                    discount.setBusinessUID(businessUID);\r\n                    discount.setExpiringDate(String.valueOf(expiringDateInMillis));\r\n                    discount.setDescription(stringedDescription);\r\n                    discount.setDiscountsQuantity(stringedQuantity);\r\n                    discount.setStartDiscountDate(todayInMills);\r\n                    addDiscount(customDiscountUID,discount);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    @Override\r\n    protected void onStart() {\r\n        super.onStart();\r\n        NetworkController networkController =new NetworkController();\r\n        if(!networkController.isConnected(ManageDiscount.this)){\r\n            networkController.connectionDialog(ManageDiscount.this);\r\n        }\r\n    }\r\n\r\n    @Override\r\n    public boolean onOptionsItemSelected(@NonNull MenuItem item) {\r\n        if(item.getItemId() == android.R.id.home){\r\n            finish();\r\n        }\r\n        return super.onOptionsItemSelected(item);\r\n    }\r\n\r\n    private void addDiscount(String customDiscountUID, Discount discount){\r\n        db.collection(\"sconti\").document(customDiscountUID).set(discount).addOnCompleteListener(new OnCompleteListener<Void>() {\r\n            @Override\r\n            public void onComplete(@NonNull Task<Void> task) {\r\n                if(task.isSuccessful()){\r\n                    Log.d(\"customDiscountUID\",customDiscountUID);\r\n                    getBusiness(customDiscountUID);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    private boolean checkDateFormat(){\r\n        String stringDate = dateEditText;\r\n         Pattern DATE_PATTERN = Pattern.compile(\"([0-9]{2})/([0-9]{2})/([0-9]{4})\");\r\n        separetedDate = stringDate.split(\"/\");\r\n        Date dateEditText = null;\r\n\r\n        try {\r\n             dateEditText = new SimpleDateFormat(\"dd/MM/yyyy\").parse(stringDate);\r\n        } catch (ParseException e) {\r\n            e.printStackTrace();\r\n        }\r\n\r\n        if(stringDate.isEmpty()){\r\n            this.expiringDate.setError(getResources().getString(R.string.EmptyDate));\r\n            this.expiringDate.requestFocus();\r\n            return false;\r\n        }else if(!DATE_PATTERN.matcher(stringDate).matches()){\r\n             Toast toast = Toast.makeText(ManageDiscount.this,\"Rispettare formato: gg/mm/aaaa\",Toast.LENGTH_LONG);\r\n             toast.setGravity(Gravity.CENTER, 0, 0);\r\n             toast.show();\r\n             this.expiringDate.setError(getResources().getString(R.string.InvalidDateFormat));\r\n             this.expiringDate.requestFocus();\r\n             return false;\r\n         }else if(Integer.parseInt(separetedDate[0]) <= 00 || Integer.parseInt(separetedDate[0]) > 31){\r\n            this.expiringDate.setError(getResources().getString(R.string.NotADay));\r\n            this.expiringDate.requestFocus();\r\n            return false;\r\n        }else if(Integer.parseInt(separetedDate[1]) <= 00 || Integer.parseInt(separetedDate[1]) > 12){\r\n            this.expiringDate.setError(getResources().getString(R.string.NotAMonth));\r\n            this.expiringDate.requestFocus();\r\n            return false;\r\n        }else if(Integer.parseInt(separetedDate[2]) < Calendar.getInstance().get(Calendar.YEAR)){\r\n            this.expiringDate.setError(getResources().getString(R.string.NotAYearFree));\r\n            this.expiringDate.requestFocus();\r\n            return false;\r\n        }else if(dateEditText.getTime() <= Calendar.getInstance().getTimeInMillis()){\r\n            this.expiringDate.setError(getResources().getString(R.string.InvalidDate));\r\n            this.expiringDate.requestFocus();\r\n            return false;\r\n        }\r\n\r\n         ManageDiscount.this.expiringDateInMillis =  dateEditText.getTime();\r\n         return true;\r\n    }\r\n\r\n    private void getBusiness(String customDiscountUID){\r\n        db.collection(\"attivita\").document(businessUID).get().addOnCompleteListener(new OnCompleteListener<DocumentSnapshot>() {\r\n            @Override\r\n            public void onComplete(@NonNull Task<DocumentSnapshot> task) {\r\n                if(task.isSuccessful()){\r\n                    DocumentSnapshot document=task.getResult();\r\n                    ArrayList<String> discountUID= (ArrayList<String>) document.get(\"discountUID\");\r\n                    if(discountUID == null){\r\n                        discountUID =new ArrayList<String>();\r\n                    }\r\n                    discountUID.add(customDiscountUID);\r\n                    updateBusiness(discountUID);\r\n                }\r\n            }\r\n        });\r\n    }\r\n    private void updateBusiness(ArrayList<String> discountUID){\r\n        db.collection(\"attivita\").document(businessUID).update(\"discountUID\",discountUID).addOnCompleteListener(new OnCompleteListener<Void>() {\r\n            @Override\r\n            public void onComplete(@NonNull Task<Void> task) {\r\n                if(task.isSuccessful()){\r\n                    Log.d(\"caricamento\",\"caricamento effettuato correttamente\");\r\n                }else{\r\n                    Log.d(\"caricamento\",\"caricamento non effettuato correttamente\");\r\n                }\r\n            }\r\n        }).addOnCompleteListener(new OnCompleteListener<Void>() {\r\n            @Override\r\n            public void onComplete(@NonNull Task<Void> task) {\r\n                finish();\r\n            }\r\n        });\r\n    }\r\n\r\n    private boolean checkInfo(){\r\n        stringedDescription=this.description.getText().toString().trim();\r\n        stringedQuantity=this.quantity.getText().toString().trim();\r\n        if(fromEditText)\r\n        dateEditText = expiringDate.getText().toString().trim();\r\n       // Log.d(\"MILLIS\", String.valueOf(expiringDateInMillis));\r\n        //Log.d(\"MILLIS\", String.valueOf(cal.getTimeInMillis()));\r\n\r\n        if(stringedDescription.isEmpty() || stringedDescription.length()>50){\r\n            this.description.setError( getResources().getString(R.string.InvalidDescription));\r\n            this.description.requestFocus();\r\n            return false;\r\n        }else if(stringedQuantity.isEmpty()){\r\n            this.quantity.setError( getResources().getString(R.string.numStepsEmpty));\r\n            this.quantity.requestFocus();\r\n            return false;\r\n        }else if(Long.parseLong(stringedQuantity) < 2000||  Long.parseLong(stringedQuantity) > 60000){\r\n            Toast toast = Toast.makeText(this,\"inserire un numero passi che sia compreso tra 2000 e 100000\",Toast.LENGTH_LONG);\r\n            toast.setGravity(Gravity.CENTER, 0, 0);\r\n            toast.show();\r\n            this.quantity.setError( getResources().getString(R.string.numStepsNotValid));\r\n            this.quantity.requestFocus();\r\n            return false;\r\n        } else if ((expiringDateInMillis <= cal.getTimeInMillis() || expiringDateInMillis == 0) && !fromEditText){\r\n            //mettere un avviso che indica di inserire correttamente la data\r\n            this.expiringDate.setError(\"Data non valida\");\r\n            this.expiringDate.requestFocus();\r\n            return false;\r\n        }else if(fromEditText && !checkDateFormat()){\r\n\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n    private String calculateMyCustomDiscountUID(String businessUID,long timeInMillis){\r\n        String stringedTimeInMills= String.valueOf(System.currentTimeMillis());\r\n        if(businessUID!=null && stringedTimeInMills!=null){\r\n            String customUID=null;\r\n            customUID= businessUID+stringedTimeInMills;\r\n            return customUID;\r\n        }else{\r\n            return null;\r\n        }\r\n    }\r\n    private String getTodayInMills(){\r\n        Calendar cal = Calendar.getInstance();\r\n        int year  = cal.get(Calendar.YEAR);\r\n        int month = cal.get(Calendar.MONTH);\r\n        int date  = cal.get(Calendar.DATE);\r\n        cal.clear();\r\n        cal.set(year, month, date);\r\n        long todayMillis2 = cal.getTimeInMillis();\r\n        return String.valueOf(todayMillis2);\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/walktoshop/Seller/ManageDiscount.java	(revision 9f2b292f2f2efab664a5a56c7c4b7a1bdd29ab70)
+++ app/src/main/java/com/example/walktoshop/Seller/ManageDiscount.java	(date 1612263666739)
@@ -145,6 +145,8 @@
                     discount.setDiscountsQuantity(stringedQuantity);
                     discount.setStartDiscountDate(todayInMills);
                     addDiscount(customDiscountUID,discount);
+                    Toast toast = Toast.makeText(getApplicationContext(),"Inserimento sconto avvenuto con successo!",Toast.LENGTH_SHORT);
+                    toast.show();
                 }
             }
         });
diff --git .idea/shelf/Uncommitted_changes_before_Update_at_01_02_2021_12_57__Default_Changelist_.xml .idea/shelf/Uncommitted_changes_before_Update_at_01_02_2021_12_57__Default_Changelist_.xml
